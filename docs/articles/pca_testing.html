<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="visualizationQualityControl">
<title>PCA Testing • visualizationQualityControl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PCA Testing">
<meta property="og:description" content="visualizationQualityControl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">visualizationQualityControl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pca_testing.html">PCA Testing</a>
    <a class="dropdown-item" href="../articles/quality_control.html">Quality Control Example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/moseleybioinformaticslab/visualizationQualityControl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>PCA Testing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/moseleybioinformaticslab/visualizationQualityControl/blob/HEAD/vignettes/pca_testing.Rmd" class="external-link"><code>vignettes/pca_testing.Rmd</code></a></small>
      <div class="d-none name"><code>pca_testing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://moseleybioinformaticslab.github.io/visualizationQualityControl" class="external-link">visualizationQualityControl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>Principal components analysis (PCA) and related methods are very useful data decomposition methods. However, when one has hundreds or thousands of variables as many -omics methods do, any information beyond just examining PC1 and PC2 is often lost.</p>
<p>However, there may be opportunities to examine the association of sample scores on each principal component to see if they are associated with any particular sample variable of interest. Following that, we can test the loadings of the variables on that PC to see if any are significantly associated with that PC. These variables may describe something important about the data that doesn’t just come from statistically significant differential differences.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The data we will use is completely artificial, in that the differences are extreme and completely made up. We have 20 samples, 10 in each class, and 1000 variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"grp_exp_data"</span><span class="op">)</span>
<span class="va">data_matrix</span> <span class="op">=</span> <span class="va">grp_exp_data</span><span class="op">$</span><span class="va">data</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">grp_exp_data</span><span class="op">$</span><span class="va">class</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span>
<span class="co">#&gt; [1] 1000   20</span></code></pre></div>
<p>This data has a proportional variance structure, where the variance increases with the value. We can see this by examining a plot of two columns in raw and log-transformed values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data_matrix</span><span class="op">)</span>
<span class="va">log_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">data_df</span><span class="op">)</span>

<span class="va">raw_plot</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s1</span>, y <span class="op">=</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">log_plot</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">log_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s1</span>, y <span class="op">=</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">raw_plot</span> <span class="op">+</span> <span class="va">log_plot</span></code></pre></div>
<p><img src="pca_testing_files/figure-html/check_proportional-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="pca">PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h2>
<p>We will use the log-transformed values, because PCA doesn’t do well with proportional variance data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_pca</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">log_df</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We can summarize the variances of each principal component.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_variances</span> <span class="op">=</span> <span class="fu"><a href="../reference/visqc_score_contributions.html">visqc_score_contributions</a></span><span class="op">(</span><span class="va">log_pca</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">log_variances</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="13%">
<col width="11%">
<col width="13%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">pc</th>
<th align="right">variance</th>
<th align="right">percent</th>
<th align="right">cumulative</th>
<th align="left">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="left">PC1</td>
<td align="right">630.300641</td>
<td align="right">0.7474956</td>
<td align="right">0.7474956</td>
<td align="left">PC1 (75%)</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="left">PC2</td>
<td align="right">15.260619</td>
<td align="right">0.0180981</td>
<td align="right">0.7655937</td>
<td align="left">PC2 (1.8%)</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="left">PC3</td>
<td align="right">14.393039</td>
<td align="right">0.0170692</td>
<td align="right">0.7826629</td>
<td align="left">PC3 (1.7%)</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="left">PC4</td>
<td align="right">13.998044</td>
<td align="right">0.0166008</td>
<td align="right">0.7992637</td>
<td align="left">PC4 (1.7%)</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="left">PC5</td>
<td align="right">13.624605</td>
<td align="right">0.0161579</td>
<td align="right">0.8154216</td>
<td align="left">PC5 (1.6%)</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="left">PC6</td>
<td align="right">13.191010</td>
<td align="right">0.0156437</td>
<td align="right">0.8310653</td>
<td align="left">PC6 (1.6%)</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="left">PC7</td>
<td align="right">12.649098</td>
<td align="right">0.0150010</td>
<td align="right">0.8460663</td>
<td align="left">PC7 (1.5%)</td>
</tr>
<tr class="even">
<td align="left">PC8</td>
<td align="left">PC8</td>
<td align="right">12.395460</td>
<td align="right">0.0147002</td>
<td align="right">0.8607665</td>
<td align="left">PC8 (1.5%)</td>
</tr>
<tr class="odd">
<td align="left">PC9</td>
<td align="left">PC9</td>
<td align="right">11.904228</td>
<td align="right">0.0141176</td>
<td align="right">0.8748841</td>
<td align="left">PC9 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC10</td>
<td align="left">PC10</td>
<td align="right">11.803515</td>
<td align="right">0.0139982</td>
<td align="right">0.8888823</td>
<td align="left">PC10 (1.4%)</td>
</tr>
<tr class="odd">
<td align="left">PC11</td>
<td align="left">PC11</td>
<td align="right">11.425450</td>
<td align="right">0.0135498</td>
<td align="right">0.9024322</td>
<td align="left">PC11 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC12</td>
<td align="left">PC12</td>
<td align="right">11.294834</td>
<td align="right">0.0133949</td>
<td align="right">0.9158271</td>
<td align="left">PC12 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC13</td>
<td align="left">PC13</td>
<td align="right">10.735845</td>
<td align="right">0.0127320</td>
<td align="right">0.9285591</td>
<td align="left">PC13 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC14</td>
<td align="left">PC14</td>
<td align="right">10.627450</td>
<td align="right">0.0126035</td>
<td align="right">0.9411626</td>
<td align="left">PC14 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC15</td>
<td align="left">PC15</td>
<td align="right">10.585936</td>
<td align="right">0.0125542</td>
<td align="right">0.9537168</td>
<td align="left">PC15 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC16</td>
<td align="left">PC16</td>
<td align="right">10.338576</td>
<td align="right">0.0122609</td>
<td align="right">0.9659777</td>
<td align="left">PC16 (1.2%)</td>
</tr>
<tr class="odd">
<td align="left">PC17</td>
<td align="left">PC17</td>
<td align="right">10.188966</td>
<td align="right">0.0120835</td>
<td align="right">0.9780612</td>
<td align="left">PC17 (1.2%)</td>
</tr>
<tr class="even">
<td align="left">PC18</td>
<td align="left">PC18</td>
<td align="right">9.646507</td>
<td align="right">0.0114401</td>
<td align="right">0.9895013</td>
<td align="left">PC18 (1.1%)</td>
</tr>
<tr class="odd">
<td align="left">PC19</td>
<td align="left">PC19</td>
<td align="right">8.852683</td>
<td align="right">0.0104987</td>
<td align="right">1.0000000</td>
<td align="left">PC19 (1%)</td>
</tr>
<tr class="even">
<td align="left">PC20</td>
<td align="left">PC20</td>
<td align="right">0.000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="left">PC20 (0.0000000000000000000000000000041%)</td>
</tr>
</tbody>
</table>
<p>And we can add the scores to the sample info so we can plot them by sample type.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_scores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">log_pca</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="va">sample_info</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">log_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="pca_testing_files/figure-html/add_scores-1.png" width="700"></p>
<p>Great, our <code>class</code> variable is definitely associated with PC1. What if there was some variable we were interested in knowing if there was a PC associated with it?</p>
</div>
<div class="section level2">
<h2 id="test-pcs">Test PCs<a class="anchor" aria-label="anchor" href="#test-pcs"></a>
</h2>
<p>The only one here should be PC1, but lets go through and test them anyway.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pc_stats</span> <span class="op">=</span> <span class="fu"><a href="../reference/visqc_test_pca_scores.html">visqc_test_pca_scores</a></span><span class="op">(</span><span class="va">log_pca</span><span class="op">$</span><span class="va">x</span>, <span class="va">sample_info</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">pc_stats</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">term</th>
<th align="right">df</th>
<th align="right">sumsq</th>
<th align="right">meansq</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="left">PC</th>
<th align="left">variable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.196857e+04</td>
<td align="right">1.196857e+04</td>
<td align="right">3.015770e+04</td>
<td align="right">0.0000000</td>
<td align="left">PC1</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">3.780000e-05</td>
<td align="right">3.780000e-05</td>
<td align="right">2.300000e-06</td>
<td align="right">0.9987946</td>
<td align="left">PC2</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">7.243800e-03</td>
<td align="right">7.243800e-03</td>
<td align="right">4.768000e-04</td>
<td align="right">0.9828191</td>
<td align="left">PC3</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.084890e-02</td>
<td align="right">1.084890e-02</td>
<td align="right">7.343000e-04</td>
<td align="right">0.9786802</td>
<td align="left">PC4</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.150000e-05</td>
<td align="right">1.150000e-05</td>
<td align="right">8.000000e-07</td>
<td align="right">0.9992956</td>
<td align="left">PC5</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">7.713200e-03</td>
<td align="right">7.713200e-03</td>
<td align="right">5.540000e-04</td>
<td align="right">0.9814812</td>
<td align="left">PC6</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.605300e-03</td>
<td align="right">1.605300e-03</td>
<td align="right">1.202000e-04</td>
<td align="right">0.9913719</td>
<td align="left">PC7</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">0.000000e+00</td>
<td align="right">0.000000e+00</td>
<td align="right">0.000000e+00</td>
<td align="right">0.9999533</td>
<td align="left">PC8</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.384000e-04</td>
<td align="right">1.384000e-04</td>
<td align="right">1.100000e-05</td>
<td align="right">0.9973883</td>
<td align="left">PC9</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">5.684000e-04</td>
<td align="right">5.684000e-04</td>
<td align="right">4.560000e-05</td>
<td align="right">0.9946852</td>
<td align="left">PC10</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.231200e-02</td>
<td align="right">1.231200e-02</td>
<td align="right">1.020900e-03</td>
<td align="right">0.9748619</td>
<td align="left">PC11</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">5.503900e-03</td>
<td align="right">5.503900e-03</td>
<td align="right">4.617000e-04</td>
<td align="right">0.9830942</td>
<td align="left">PC12</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">2.510000e-04</td>
<td align="right">2.510000e-04</td>
<td align="right">2.220000e-05</td>
<td align="right">0.9962966</td>
<td align="left">PC13</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">2.671100e-03</td>
<td align="right">2.671100e-03</td>
<td align="right">2.381000e-04</td>
<td align="right">0.9878581</td>
<td align="left">PC14</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">1.366700e-03</td>
<td align="right">1.366700e-03</td>
<td align="right">1.223000e-04</td>
<td align="right">0.9912975</td>
<td align="left">PC15</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">2.072800e-02</td>
<td align="right">2.072800e-02</td>
<td align="right">1.899600e-03</td>
<td align="right">0.9657156</td>
<td align="left">PC16</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">5.379520e-02</td>
<td align="right">5.379520e-02</td>
<td align="right">5.003300e-03</td>
<td align="right">0.9443896</td>
<td align="left">PC17</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">2.221000e-04</td>
<td align="right">2.221000e-04</td>
<td align="right">2.180000e-05</td>
<td align="right">0.9963248</td>
<td align="left">PC18</td>
<td align="left">class</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">3.670000e-05</td>
<td align="right">3.670000e-05</td>
<td align="right">3.900000e-06</td>
<td align="right">0.9984416</td>
<td align="left">PC19</td>
<td align="left">class</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1</td>
<td align="right">0.000000e+00</td>
<td align="right">0.000000e+00</td>
<td align="right">9.185785e-01</td>
<td align="right">0.3505460</td>
<td align="left">PC20</td>
<td align="left">class</td>
</tr>
</tbody>
</table>
<p>As this is an artificial data-set, we expect that only PC1 is going to come back with something significant. We can double check the ANOVA results by plotting the scores in one-dimension as well.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">log_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, position <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></code></pre></div>
<p><img src="pca_testing_files/figure-html/plot_single-1.png" width="700"></p>
<p>Again, this is a contrived example, so things separate really, really well.</p>
</div>
<div class="section level2">
<h2 id="test-loadings">Test Loadings<a class="anchor" aria-label="anchor" href="#test-loadings"></a>
</h2>
<p>We can also run a statistical test on the loadings for each variable on each PC. The way this works is to construct a <strong>null</strong> distribution of loadings from all of the other variables in all of the other PCs outside of the current one being tested. We will test both PC1 and PC2 here, because we don’t really expect that there should be that many on PC2. Note that for a large number of variables, this will take some time, because a slightly different null is created for each variable by excluding that variables loadings in the other PCs.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loading_sig</span> <span class="op">=</span> <span class="fu"><a href="../reference/visqc_test_pca_loadings.html">visqc_test_pca_loadings</a></span><span class="op">(</span><span class="va">log_pca</span><span class="op">$</span><span class="va">rotation</span>, test_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">loading_sig</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">p.value</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; PC1 PC2 </span>
<span class="co">#&gt;  59  53</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert M Flight, Hunter NB Moseley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
