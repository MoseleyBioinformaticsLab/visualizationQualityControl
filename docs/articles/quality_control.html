<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="visualizationQualityControl">
<title>Quality Control Example • visualizationQualityControl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quality Control Example">
<meta property="og:description" content="visualizationQualityControl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">visualizationQualityControl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pca_testing.html">PCA Testing</a>
    <a class="dropdown-item" href="../articles/quality_control.html">Quality Control Example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/moseleybioinformaticslab/visualizationQualityControl/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quality Control Example</h1>
                        <h4 data-toc-skip class="author">Robert M
Flight</h4>
            
            <h4 data-toc-skip class="date">2023-07-12
20:04:07.201599</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/moseleybioinformaticslab/visualizationQualityControl/blob/HEAD/vignettes/quality_control.Rmd" class="external-link"><code>vignettes/quality_control.Rmd</code></a></small>
      <div class="d-none name"><code>quality_control.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette shows how the various functions in this package can be
used for basic quality control, in addition to advocating a particular
workflow for examining experimental data prior to analysis. These steps
consist of:</p>
<ul>
<li>Principal components analysis</li>
<li>Correlation heatmap</li>
<li>Median correlation</li>
<li>Feature outliers</li>
</ul>
<p>In all of the examples, we will compare and contrast a dataset that
is composed of two different conditions, and the same dataset wherein
two samples have had their class labels switched by mistake, and how the
visualizations above can illustrate potential problems.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://moseleybioinformaticslab.github.io/visualizationQualityControl" class="external-link">visualizationQualityControl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">grp_exp_data</span><span class="op">)</span></span>
<span><span class="va">exp_data</span> <span class="op">&lt;-</span> <span class="va">grp_exp_data</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">grp_exp_data</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span><span class="va">sample_classes</span> <span class="op">&lt;-</span> <span class="va">sample_info</span><span class="op">$</span><span class="va">class</span></span>
<span></span>
<span><span class="va">mix_data</span> <span class="op">&lt;-</span> <span class="va">exp_data</span></span>
<span><span class="va">mix_data</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_data</span><span class="op">[</span>, <span class="fl">19</span><span class="op">]</span></span>
<span><span class="va">mix_data</span><span class="op">[</span>, <span class="fl">19</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_data</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<p>The data used here are from a simulated experiment, where there are
two classes of samples. 1000 features measured, across 20 samples from 2
groups, with 10 in each group.</p>
<p>The actual values we are going to use are in <code>exp_data</code>.
The classes of samples are defined in <code>sample_classes</code>. We
will also create a version of the data that has two samples completely
switched by accident, labels and all, in <code>mix_data</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  num [1:1000, 1:20] 0.833 3.826 15.87 0.842 1.87 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:1000] "f1" "f2" "f3" "f4" ...</span></span>
<span><span class="co">##   ..$ : chr [1:20] "s1" "s2" "s3" "s4" ...</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##            s1       s2        s3        s4       s5</span></span>
<span><span class="co">## f1  0.8326984 1.795155 0.9698029  0.000000 0.000000</span></span>
<span><span class="co">## f2  3.8262483 3.103851 1.9064043  3.446350 6.217429</span></span>
<span><span class="co">## f3 15.8695770 7.078666 5.6856675 11.138222 7.580068</span></span>
<span><span class="co">## f4  0.8422794 0.000000 1.8026048  0.171272 0.000000</span></span>
<span><span class="co">## f5  1.8696869 7.724530 3.9550344  1.919573 1.087596</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_info</span></span></code></pre></div>
<pre><code><span><span class="co">##     id class</span></span>
<span><span class="co">## 1   s1  grp1</span></span>
<span><span class="co">## 2   s2  grp1</span></span>
<span><span class="co">## 3   s3  grp1</span></span>
<span><span class="co">## 4   s4  grp1</span></span>
<span><span class="co">## 5   s5  grp1</span></span>
<span><span class="co">## 6   s6  grp1</span></span>
<span><span class="co">## 7   s7  grp1</span></span>
<span><span class="co">## 8   s8  grp1</span></span>
<span><span class="co">## 9   s9  grp1</span></span>
<span><span class="co">## 10 s10  grp1</span></span>
<span><span class="co">## 11 s11  grp2</span></span>
<span><span class="co">## 12 s12  grp2</span></span>
<span><span class="co">## 13 s13  grp2</span></span>
<span><span class="co">## 14 s14  grp2</span></span>
<span><span class="co">## 15 s15  grp2</span></span>
<span><span class="co">## 16 s16  grp2</span></span>
<span><span class="co">## 17 s17  grp2</span></span>
<span><span class="co">## 18 s18  grp2</span></span>
<span><span class="co">## 19 s19  grp2</span></span>
<span><span class="co">## 20 s20  grp2</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="data-transformation">Data Transformation<a class="anchor" aria-label="anchor" href="#data-transformation"></a>
</h2>
<p>Before we do anything else, we need to transform the data. This is
because this and other -omics data frequently have a distribution and
error structure that many statistical methods will completely choke on,
or at least give you incorrect results.</p>
<p><strong>Make sure to ask</strong> if data has been transformed in any
way!</p>
<p>Here I will show what the raw and transformed data looks like.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s1</span>, y <span class="op">=</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw Data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/raw_plot-1.png" width="768"></p>
<p>Notice the dispersion in the values as the actual values increase.
Most statistical methods don’t like this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">log_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">log_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s1</span>, y <span class="op">=</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Log Transform"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/log_plot-1.png" width="768"></p>
<p>But, lots of other methods don’t deal well with <code>NA</code> or
<code>Inf</code> values, which is what you get when you do a
log-transform on negative or zero values. There are a couple of
solutions:</p>
<ul>
<li>If have negatives, add the most negative + small offset</li>
<li>If have zeros, use <code>log1p</code> to handle zero and small
values</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log1_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">small_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">[</span><span class="va">exp_data</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span>
<span><span class="va">log2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">exp_data</span> <span class="op">+</span> <span class="va">small_value</span><span class="op">)</span></span></code></pre></div>
<p>Most of the methods in this package can handle the presence of
<code>NA</code> or <code>Inf</code>, except for the principal components
analysis (PCA). Because we have physical data, the lowest value should
be zero. Therefore we can use <code>log1p</code>, which will keep the
zeros as zeros. Alternatively, we could use <code>log1p</code> for PCA,
and <code>log</code> for the correlations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span></span>
<span><span class="va">log_mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">mix_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="principal-components-analysis">Principal Components Analysis<a class="anchor" aria-label="anchor" href="#principal-components-analysis"></a>
</h2>
<p>As a first step, we will use principal components analysis (PCA) to
decompose the data. PCA is trying to find linear combinations of the
original variables that account for the maximum amount of variance, and
then finding the next combination that is orthogonal to the first, and
so on and so on. It is extemely useful for confirming that the largest
source of variance is the biological one, and for examining if any
confounds can explain some sources of variance.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">log_data</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pca_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">log_mix</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="visualize-them">Visualize Them<a class="anchor" aria-label="anchor" href="#visualize-them"></a>
</h3>
<p>To visualize the data, we plot the scores. If we want to know how
much a PC contributes to the variances, we can get a summary of them
using <code>visqc_score_contributions</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd_scores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="va">sample_info</span><span class="op">)</span></span>
<span><span class="va">gd_pca</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">gd_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Good Data"</span><span class="op">)</span></span>
<span><span class="va">gd_pca</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_good-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/visqc_score_contributions.html">visqc_score_contributions</a></span><span class="op">(</span><span class="va">pca_data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="6%">
<col width="13%">
<col width="12%">
<col width="13%">
<col width="49%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">pc</th>
<th align="right">variance</th>
<th align="right">percent</th>
<th align="right">cumulative</th>
<th align="left">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="left">PC1</td>
<td align="right">630.300641</td>
<td align="right">0.7474956</td>
<td align="right">0.7474956</td>
<td align="left">PC1 (75%)</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="left">PC2</td>
<td align="right">15.260619</td>
<td align="right">0.0180981</td>
<td align="right">0.7655937</td>
<td align="left">PC2 (1.8%)</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="left">PC3</td>
<td align="right">14.393039</td>
<td align="right">0.0170692</td>
<td align="right">0.7826629</td>
<td align="left">PC3 (1.7%)</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="left">PC4</td>
<td align="right">13.998044</td>
<td align="right">0.0166008</td>
<td align="right">0.7992637</td>
<td align="left">PC4 (1.7%)</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="left">PC5</td>
<td align="right">13.624605</td>
<td align="right">0.0161579</td>
<td align="right">0.8154216</td>
<td align="left">PC5 (1.6%)</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="left">PC6</td>
<td align="right">13.191010</td>
<td align="right">0.0156437</td>
<td align="right">0.8310653</td>
<td align="left">PC6 (1.6%)</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="left">PC7</td>
<td align="right">12.649098</td>
<td align="right">0.0150010</td>
<td align="right">0.8460663</td>
<td align="left">PC7 (1.5%)</td>
</tr>
<tr class="even">
<td align="left">PC8</td>
<td align="left">PC8</td>
<td align="right">12.395460</td>
<td align="right">0.0147002</td>
<td align="right">0.8607665</td>
<td align="left">PC8 (1.5%)</td>
</tr>
<tr class="odd">
<td align="left">PC9</td>
<td align="left">PC9</td>
<td align="right">11.904228</td>
<td align="right">0.0141176</td>
<td align="right">0.8748841</td>
<td align="left">PC9 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC10</td>
<td align="left">PC10</td>
<td align="right">11.803515</td>
<td align="right">0.0139982</td>
<td align="right">0.8888823</td>
<td align="left">PC10 (1.4%)</td>
</tr>
<tr class="odd">
<td align="left">PC11</td>
<td align="left">PC11</td>
<td align="right">11.425450</td>
<td align="right">0.0135498</td>
<td align="right">0.9024322</td>
<td align="left">PC11 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC12</td>
<td align="left">PC12</td>
<td align="right">11.294834</td>
<td align="right">0.0133949</td>
<td align="right">0.9158271</td>
<td align="left">PC12 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC13</td>
<td align="left">PC13</td>
<td align="right">10.735845</td>
<td align="right">0.0127320</td>
<td align="right">0.9285591</td>
<td align="left">PC13 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC14</td>
<td align="left">PC14</td>
<td align="right">10.627450</td>
<td align="right">0.0126035</td>
<td align="right">0.9411626</td>
<td align="left">PC14 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC15</td>
<td align="left">PC15</td>
<td align="right">10.585936</td>
<td align="right">0.0125542</td>
<td align="right">0.9537168</td>
<td align="left">PC15 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC16</td>
<td align="left">PC16</td>
<td align="right">10.338576</td>
<td align="right">0.0122609</td>
<td align="right">0.9659777</td>
<td align="left">PC16 (1.2%)</td>
</tr>
<tr class="odd">
<td align="left">PC17</td>
<td align="left">PC17</td>
<td align="right">10.188966</td>
<td align="right">0.0120835</td>
<td align="right">0.9780612</td>
<td align="left">PC17 (1.2%)</td>
</tr>
<tr class="even">
<td align="left">PC18</td>
<td align="left">PC18</td>
<td align="right">9.646507</td>
<td align="right">0.0114401</td>
<td align="right">0.9895013</td>
<td align="left">PC18 (1.1%)</td>
</tr>
<tr class="odd">
<td align="left">PC19</td>
<td align="left">PC19</td>
<td align="right">8.852683</td>
<td align="right">0.0104987</td>
<td align="right">1.0000000</td>
<td align="left">PC19 (1%)</td>
</tr>
<tr class="even">
<td align="left">PC20</td>
<td align="left">PC20</td>
<td align="right">0.000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="left">PC20 (0.000000000000000000000000000016%)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_scores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pca_mixed</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="va">sample_info</span><span class="op">)</span></span>
<span><span class="va">bad_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bad_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Bad Data"</span><span class="op">)</span></span>
<span><span class="va">bad_pca</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_bad-1.png" width="768"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/visqc_score_contributions.html">visqc_score_contributions</a></span><span class="op">(</span><span class="va">pca_mixed</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="13%">
<col width="11%">
<col width="13%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">pc</th>
<th align="right">variance</th>
<th align="right">percent</th>
<th align="right">cumulative</th>
<th align="left">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="left">PC1</td>
<td align="right">630.300641</td>
<td align="right">0.7474956</td>
<td align="right">0.7474956</td>
<td align="left">PC1 (75%)</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="left">PC2</td>
<td align="right">15.260619</td>
<td align="right">0.0180981</td>
<td align="right">0.7655937</td>
<td align="left">PC2 (1.8%)</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="left">PC3</td>
<td align="right">14.393039</td>
<td align="right">0.0170692</td>
<td align="right">0.7826629</td>
<td align="left">PC3 (1.7%)</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="left">PC4</td>
<td align="right">13.998044</td>
<td align="right">0.0166008</td>
<td align="right">0.7992637</td>
<td align="left">PC4 (1.7%)</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="left">PC5</td>
<td align="right">13.624605</td>
<td align="right">0.0161579</td>
<td align="right">0.8154216</td>
<td align="left">PC5 (1.6%)</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="left">PC6</td>
<td align="right">13.191010</td>
<td align="right">0.0156437</td>
<td align="right">0.8310653</td>
<td align="left">PC6 (1.6%)</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="left">PC7</td>
<td align="right">12.649098</td>
<td align="right">0.0150010</td>
<td align="right">0.8460663</td>
<td align="left">PC7 (1.5%)</td>
</tr>
<tr class="even">
<td align="left">PC8</td>
<td align="left">PC8</td>
<td align="right">12.395460</td>
<td align="right">0.0147002</td>
<td align="right">0.8607665</td>
<td align="left">PC8 (1.5%)</td>
</tr>
<tr class="odd">
<td align="left">PC9</td>
<td align="left">PC9</td>
<td align="right">11.904228</td>
<td align="right">0.0141176</td>
<td align="right">0.8748841</td>
<td align="left">PC9 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC10</td>
<td align="left">PC10</td>
<td align="right">11.803515</td>
<td align="right">0.0139982</td>
<td align="right">0.8888823</td>
<td align="left">PC10 (1.4%)</td>
</tr>
<tr class="odd">
<td align="left">PC11</td>
<td align="left">PC11</td>
<td align="right">11.425450</td>
<td align="right">0.0135498</td>
<td align="right">0.9024322</td>
<td align="left">PC11 (1.4%)</td>
</tr>
<tr class="even">
<td align="left">PC12</td>
<td align="left">PC12</td>
<td align="right">11.294834</td>
<td align="right">0.0133949</td>
<td align="right">0.9158271</td>
<td align="left">PC12 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC13</td>
<td align="left">PC13</td>
<td align="right">10.735845</td>
<td align="right">0.0127320</td>
<td align="right">0.9285591</td>
<td align="left">PC13 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC14</td>
<td align="left">PC14</td>
<td align="right">10.627450</td>
<td align="right">0.0126035</td>
<td align="right">0.9411626</td>
<td align="left">PC14 (1.3%)</td>
</tr>
<tr class="odd">
<td align="left">PC15</td>
<td align="left">PC15</td>
<td align="right">10.585936</td>
<td align="right">0.0125542</td>
<td align="right">0.9537168</td>
<td align="left">PC15 (1.3%)</td>
</tr>
<tr class="even">
<td align="left">PC16</td>
<td align="left">PC16</td>
<td align="right">10.338576</td>
<td align="right">0.0122609</td>
<td align="right">0.9659777</td>
<td align="left">PC16 (1.2%)</td>
</tr>
<tr class="odd">
<td align="left">PC17</td>
<td align="left">PC17</td>
<td align="right">10.188966</td>
<td align="right">0.0120835</td>
<td align="right">0.9780612</td>
<td align="left">PC17 (1.2%)</td>
</tr>
<tr class="even">
<td align="left">PC18</td>
<td align="left">PC18</td>
<td align="right">9.646507</td>
<td align="right">0.0114401</td>
<td align="right">0.9895013</td>
<td align="left">PC18 (1.1%)</td>
</tr>
<tr class="odd">
<td align="left">PC19</td>
<td align="left">PC19</td>
<td align="right">8.852683</td>
<td align="right">0.0104987</td>
<td align="right">1.0000000</td>
<td align="left">PC19 (1%)</td>
</tr>
<tr class="even">
<td align="left">PC20</td>
<td align="left">PC20</td>
<td align="right">0.000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="left">PC20 (0.0000000000000000000000000000081%)</td>
</tr>
</tbody>
</table>
<p>Note in this case <strong>PC1</strong> contains a large proportion of
variance, and separates the samples very well. The PCA plots rarely look
this good in practice!</p>
</div>
</div>
<div class="section level2">
<h2 id="correlation-heatmap">Correlation Heatmap<a class="anchor" aria-label="anchor" href="#correlation-heatmap"></a>
</h2>
<p>Correlation heatmaps show much of the same information as the PCA
plots, but in a different way.</p>
<div class="section level3">
<h3 id="calculate-correlations">Calculate Correlations<a class="anchor" aria-label="anchor" href="#calculate-correlations"></a>
</h3>
<p>We recommend to use our information-content-informed Kendall-tau
{ICIKendallTau::ici_kendalltau} correlation, that is scale invariant,
and includes some effects of missing values. Note that we take the
transpose of the data, because this function assumes that data are
organized with <em>features</em> as <em>columns</em> and
<em>samples</em> as <em>rows</em>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_cor</span> <span class="op">&lt;-</span> <span class="fu">ICIKendallTau</span><span class="fu">::</span><span class="fu"><a href="https://moseleybioinformaticslab.github.io/ICIKendallTau/reference/ici_kendalltau.html" class="external-link">ici_kendalltau</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">exp_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This returns a list with some useful information, the actual
correlations in <code>cor</code>, the number of points in each
correlation in <code>count</code>, and which points pass the various
filters in <code>keep</code>. We are really only interested in
<code>cor</code> in this case.</p>
<p>We can also check that we did the right correlations by looking at
the dimensions of the matrix, in this case we expect a 20 <em>by</em> 20
matrix.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_cor</span> <span class="op">&lt;-</span> <span class="va">data_cor</span><span class="op">$</span><span class="va">cor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_cor</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20 20</span></span></code></pre>
<p>We also do the same for our <strong>mixed-up</strong> data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix_cor</span> <span class="op">&lt;-</span> <span class="fu">ICIKendallTau</span><span class="fu">::</span><span class="fu"><a href="https://moseleybioinformaticslab.github.io/ICIKendallTau/reference/ici_kendalltau.html" class="external-link">ici_kendalltau</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mix_data</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">cor</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reorder-correlations">Reorder Correlations<a class="anchor" aria-label="anchor" href="#reorder-correlations"></a>
</h3>
<p>To make the heatmap more useful, we also do clustering within each of
the <strong>sample classes</strong> and reorder the correlations, this
highlights sub-groups within classes as well as potential outliers.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/similarity_reorderbyclass.html">similarity_reorderbyclass</a></span><span class="op">(</span><span class="va">data_cor</span>, <span class="va">sample_info</span><span class="op">[</span>, <span class="st">"class"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span>
<span>                                        transform <span class="op">=</span> <span class="st">"sub_1"</span><span class="op">)</span></span>
<span><span class="va">mix_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/similarity_reorderbyclass.html">similarity_reorderbyclass</a></span><span class="op">(</span><span class="va">mix_cor</span>, <span class="va">sample_info</span><span class="op">[</span>, <span class="st">"class"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span>
<span>                                       transform <span class="op">=</span> <span class="st">"sub_1"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="color-by-class">Color by Class<a class="anchor" aria-label="anchor" href="#color-by-class"></a>
</h3>
<p>We also want to color them by their class.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_group_colors.html">generate_group_colors</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_legend</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grp1"</span>, <span class="st">"grp2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">row_data</span> <span class="op">&lt;-</span> <span class="va">sample_info</span><span class="op">[</span>, <span class="st">"class"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">row_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">data_legend</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="map-correlation-to-color">Map Correlation to Color<a class="anchor" aria-label="anchor" href="#map-correlation-to-color"></a>
</h3>
<p>Correlation values are mapped to colors using the
<code>colorRamp2</code> function, by specifying the range of
correlations, and what colors to map them to. Here the
<code>viridis</code> color-scale is used because it is perceptually
uniform and is good for those suffering from various types of color
blindness. Other choices might be <strong>black -&gt; white</strong>, or
the other color maps in the <code>viridis</code> package. More
information about <code>viridis</code> is available <a href="http://bids.github.io/colormap/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span></span>
<span><span class="va">colormap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="heatmap">Heatmap!<a class="anchor" aria-label="anchor" href="#heatmap"></a>
</h3>
<p>Finally we can make the heatmaps!</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visqc_heatmap.html">visqc_heatmap</a></span><span class="op">(</span><span class="va">data_cor</span>, <span class="va">colormap</span>, <span class="st">"Good Data"</span>, row_color_data <span class="op">=</span> <span class="va">row_data</span>,</span>
<span>              row_color_list <span class="op">=</span> <span class="va">row_annotation</span>, col_color_data <span class="op">=</span> <span class="va">row_data</span>,</span>
<span>              col_color_list <span class="op">=</span> <span class="va">row_annotation</span>, row_order <span class="op">=</span> <span class="va">data_order</span><span class="op">$</span><span class="va">indices</span>,</span>
<span>              column_order <span class="op">=</span> <span class="va">data_order</span><span class="op">$</span><span class="va">indices</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/heatmap1-1.png" width="480"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visqc_heatmap.html">visqc_heatmap</a></span><span class="op">(</span><span class="va">mix_cor</span>, <span class="va">colormap</span>, <span class="st">"Bad Data"</span>, row_color_data <span class="op">=</span> <span class="va">row_data</span>,</span>
<span>              row_color_list <span class="op">=</span> <span class="va">row_annotation</span>, col_color_data <span class="op">=</span> <span class="va">row_data</span>,</span>
<span>              col_color_list <span class="op">=</span> <span class="va">row_annotation</span>, row_order <span class="op">=</span> <span class="va">mix_order</span><span class="op">$</span><span class="va">indices</span>,</span>
<span>              column_order <span class="op">=</span> <span class="va">mix_order</span><span class="op">$</span><span class="va">indices</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/heatmap2-1.png" width="480"></p>
<p>Note in the second example, <strong>s5</strong> and
<strong>s19</strong> look odd.</p>
</div>
</div>
<div class="section level2">
<h2 id="median-correlation">Median Correlation<a class="anchor" aria-label="anchor" href="#median-correlation"></a>
</h2>
<p>Lets also calculate the median correlation within each class.</p>
<div class="section level3">
<h3 id="good">Good<a class="anchor" aria-label="anchor" href="#good"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_medcor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/median_correlations.html">median_correlations</a></span><span class="op">(</span><span class="va">data_cor</span>, <span class="va">sample_info</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span></code></pre></div>
<p>And plot it using facets in <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_medcor</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="va">med_cor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sample_class</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Good Data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_med_good-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="bad">Bad<a class="anchor" aria-label="anchor" href="#bad"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix_medcor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/median_correlations.html">median_correlations</a></span><span class="op">(</span><span class="va">mix_cor</span>, <span class="va">sample_info</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span></code></pre></div>
<p>Plot it!</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mix_medcor</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="va">med_cor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sample_class</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Bad Dat"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_med_mix-1.png" width="480"></p>
</div>
</div>
<div class="section level2">
<h2 id="proportion-of-outlier-features">Proportion of Outlier Features<a class="anchor" aria-label="anchor" href="#proportion-of-outlier-features"></a>
</h2>
<p>For every feature (the rows in our matrix), within each
<strong>sample-class</strong>, calculate the <strong>trimmed</strong>
(remove the <em>x</em> highest and lowest values) <em>mean</em> and
<em>sd</em>, which features are outside a given number of <em>sd’s</em>,
and then calculate the proportion of outliers in each sample. Samples
with a deviated proportion of outliers should be examined more
closely.</p>
<p>If you are using <strong>metabolomics</strong> data with a large
number of zeros, you probably want to ignore zeros.</p>
<div class="section level3">
<h3 id="good-1">Good<a class="anchor" aria-label="anchor" href="#good-1"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_outlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outlier_fraction.html">outlier_fraction</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">log_data</span><span class="op">)</span>, <span class="va">sample_info</span><span class="op">$</span><span class="va">class</span>, remove_0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Plot them!</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_outlier</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="va">frac</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sample_class</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Good Data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_good_outliers-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="bad-1">Bad<a class="anchor" aria-label="anchor" href="#bad-1"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mix_outlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outlier_fraction.html">outlier_fraction</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mix_data</span><span class="op">)</span>, <span class="va">sample_info</span><span class="op">$</span><span class="va">class</span>, remove_0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Plot them.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mix_outlier</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="va">frac</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sample_class</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mix Data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality_control_files/figure-html/plot_mixoutliers-1.png" width="480"></p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Hopefully this has shown how you can use the various tools to examine
your high-througput -omics data for potential problems.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert M Flight, Hunter NB Moseley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
